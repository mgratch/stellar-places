"use strict";!function(e,t,a,n){var o=t.stellarPlaces||{};o.getCoordinates=function(e,t){return new google.maps.LatLng(Number(e),Number(t))},o.models={Place:Backbone.Model.extend({})},o.collections={Places:Backbone.Collection.extend({model:o.models.Place})},o.views={Map:Backbone.View.extend({render:function(){var a=this.$el,n=a.width(),i=e.parseJSON(a.attr("data-stellar-places-map-options"));i.center=o.getCoordinates(a.attr("data-stellar-places-map-lat"),a.attr("data-stellar-places-map-lng")),i.mapTypeId&&(i.mapTypeId=google.maps.MapTypeId[i.mapTypeId]);var l=new google.maps.Map(this.el,i),s=new google.maps.LatLngBounds;a.data("map",l),a.data("mapBounds",s);var r=e.parseJSON(a.attr("data-stellar-places-map-locations"));this.collection=new o.collections.Places(r);var c="true"===a.attr("data-stellar-places-map-auto-zoom"),d="true"===a.attr("data-stellar-places-map-info-windows");return this.collection.each(function(t){var a=o.getCoordinates(t.get("latitude"),t.get("longitude"));s.extend(a);var i={map:l,title:t.get("name"),position:a,icon:t.get("icon")};d||(i.cursor="default");var r=new google.maps.Marker(i);if(t.set("marker",r),d){var c=_.template(e("#stellar-places-info-window-template").html(),t.toJSON());r.infoWindow=new google.maps.InfoWindow,google.maps.event.addListener(r,"click",function(){r.infoWindow.close(),r.infoWindow.setOptions({content:c,maxWidth:n-140}),r.infoWindow.open(l,r)})}}),a.data("stellarPlacesMapLocations",this.collection.map(function(e){return e.toJSON()})),this.collection.length&&(c&&l.fitBounds(s),l.setCenter(s.getCenter()),google.maps.event.addListener(l,"resize",function(){l.setCenter(s.getCenter())})),google.maps.event.addDomListener(t,"resize",function(){var e=l.getCenter();google.maps.event.trigger(l,"resize"),l.setCenter(e)}),google.maps.event.addListener(l,"resize",function(){n=a.width(),infoWindow.close()}),this}})},o.initialize=function(){e.each(e(".stellar-places-map-canvas"),function(){new o.views.Map({el:e(this)}).render()})},e(a).ready(function(){o.initialize()})}(jQuery,window,document);