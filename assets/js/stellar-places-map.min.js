"use strict";!function(e,t,a){var n=t.stellarPlaces||{};n.getCoordinates=function(e,t){return new google.maps.LatLng(Number(e),Number(t))},n.models={Place:Backbone.Model.extend({})},n.collections={Places:Backbone.Collection.extend({model:n.models.Place})},n.views={Map:Backbone.View.extend({render:function(){var a=this.$el,o=a.width(),l=e.parseJSON(a.attr("data-stellar-places-map-options"));l.center=n.getCoordinates(a.attr("data-stellar-places-map-lat"),a.attr("data-stellar-places-map-lng")),l.mapTypeId&&(l.mapTypeId=google.maps.MapTypeId[l.mapTypeId]);var s=new google.maps.Map(this.el,l),i=new google.maps.LatLngBounds;a.data("map",s),a.data("mapBounds",i);var r=e.parseJSON(a.attr("data-stellar-places-map-locations"));this.collection=new n.collections.Places(r);var c=new google.maps.InfoWindow,d="true"===a.attr("data-stellar-places-map-auto-zoom"),p="true"===a.attr("data-stellar-places-map-info-windows");return this.collection.each(function(t){var a=n.getCoordinates(t.get("latitude"),t.get("longitude"));i.extend(a);var l={map:s,title:t.get("name"),position:a,icon:t.get("icon")};p||(l.cursor="default");var r=new google.maps.Marker(l);if(p){var d=_.template(e("#stellar-places-info-window-template").html(),t.toJSON());google.maps.event.addListener(r,"click",function(){c.close(),c.setOptions({content:d,maxWidth:o-140}),c.open(s,r)})}}),this.collection.length&&(d&&s.fitBounds(i),s.setCenter(i.getCenter()),google.maps.event.addListener(s,"resize",function(){s.setCenter(i.getCenter())})),google.maps.event.addDomListener(t,"resize",function(){var e=s.getCenter();google.maps.event.trigger(s,"resize"),s.setCenter(e)}),google.maps.event.addListener(s,"resize",function(){o=a.width(),c.close()}),this}})},n.initialize=function(){e.each(e(".stellar-places-map-canvas"),function(){new n.views.Map({el:e(this)}).render()})},e(a).ready(function(){n.initialize()})}(jQuery,window,document);